<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Timetable</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; padding: 10px; background: transparent; }

.container { max-width: 100%; }

.tabs { display: flex; gap: 8px; margin-bottom: 16px; }
.tab-button { padding: 8px 16px; border: 1px solid #e0e0e0; background: white; border-radius: 4px; font-size: 14px; cursor: pointer; transition: all 0.2s; color: #000; }
.tab-button.active { background: #0066cc; color: white; border-color: #0066cc; }

.tab-content { display: none; }
.tab-content.active { display: block; }

.timetable-grid { display: grid; grid-template-columns: 70px repeat(5, 1fr); gap: 4px; padding: 8px; border-radius: 8px; border: 1px solid #e0e0e0; }
.time-label { height: 50px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #666; font-weight: 500; }
.day-header { background: #f8f9fa; border: 1px solid #e0e0e0; padding: 10px; text-align: center; font-weight: 600; border-radius: 4px; font-size: 14px; color: #000; }

.time-slot { min-height: 50px; border: 1px dashed #ddd; border-radius: 4px; padding: 2px; position: relative; }
.time-slot.drag-over { background: #e3f2fd; border-color: #0066cc; border-style: solid; }

.event-card { padding: 4px; border-radius: 4px; font-size: 12px; border: 1px solid; position: absolute; left: 2px; right: 2px; top: 0; cursor: move; background: #e3f2fd; }
.event-card.dragging { opacity: 0.4; }
.event-card.compulsory { background: #ffebee; border-color: #ef5350; cursor: not-allowed; }
.event-card.activity { background: #e3f2fd; border-color: #42a5f5; }
.event-card.activity.past-deadline { background: #fff3e0; border-color: #ff9800; color: #e65100; border-width: 2px; border-style: dashed; }
.event-card.break { background: #f5f5f5; border-color: #bdbdbd; cursor: default; opacity: 0.85; }

.event-name { font-weight: 600; margin-bottom: 2px; }
.event-time { font-size: 11px; opacity: 0.8; }

.controls { display: flex; gap: 8px; margin-bottom: 16px; }
button { padding: 8px 16px; border-radius: 4px; cursor: pointer; border: 1px solid #e0e0e0; background: white; transition: all 0.2s; color: #000; }
button:hover { background: #f8f9fa; }
.btn-save { background: #4caf50; color: white; border-color: #4caf50; }
.btn-save:hover { background: #43a047; }
.btn-reset { background: #ff9800; color: white; border-color: #ff9800; }
.btn-reset:hover { background: #fb8c00; }

.day-list { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px; margin-bottom: 12px; }
.day-title { font-size: 16px; font-weight: 600; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #e0e0e0; }
.event-list-item { padding: 10px; margin-bottom: 6px; border-left: 3px solid; border-radius: 4px; }
.event-list-item.compulsory { background: #ffebee; border-color: #ef5350; }
.event-list-item.activity { background: #e3f2fd; border-color: #42a5f5; }
.event-list-item.activity.past-deadline { background: #fff3e0; border-color: #ff9800; }
.event-list-item.break { background: #f5f5f5; border-color: #bdbdbd; }
.event-list-item strong { font-size: 14px; display: block; margin-bottom: 4px; color: #000; }
.event-list-item span { font-size: 12px; color: #666; }
.empty-day { color: #999; font-style: italic; padding: 12px; text-align: center; font-size: 13px; }
</style>
</head>
<body>
<div class="container">
    <div class="tabs">
        <button class="tab-button active" onclick="switchTab('grid')">Grid View</button>
        <button class="tab-button" onclick="switchTab('list')">List View</button>
    </div>

    <div id="grid-tab" class="tab-content active">
        <div class="controls">
            <button class="btn-save" onclick="saveTimetable()">üíæ Save Changes</button>
            <button class="btn-reset" onclick="resetTimetable()">üîÑ Reset</button>
        </div>
        <div class="timetable-grid" id="timetable"></div>
    </div>

    <div id="list-tab" class="tab-content">
        <div id="list-view"></div>
    </div>
</div>

<script>
const DAY_NAMES = ["Monday","Tuesday","Wednesday","Thursday","Friday"];
const TIME_SLOTS = [];
for(let h=6; h<=22; h++){ for(let m of [0,15,30,45]){ TIME_SLOTS.push(`${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`); } }
const BREAK_DURATION = 120; // minutes

let timetableData = {"Monday":[],"Tuesday":[],"Wednesday":[],"Thursday":[],"Friday":[]};
let originalData = JSON.parse(JSON.stringify(timetableData));
let activityDeadlines = {};
let draggedElement=null, draggedEventData=null, originalDay=null;

function switchTab(tab){
    document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
    if(tab==='grid'){ document.querySelector('.tab-button:nth-child(1)').classList.add('active'); document.getElementById('grid-tab').classList.add('active'); }
    else { document.querySelector('.tab-button:nth-child(2)').classList.add('active'); document.getElementById('list-tab').classList.add('active'); renderListView(); }
}

function timeToMinutes(t){ const [h,m]=t.split(':').map(Number); return h*60+m; }
function minutesToTime(m){ return `${Math.floor(m/60).toString().padStart(2,'0')}:${(m%60).toString().padStart(2,'0')}`; }

function getEventsInSlot(day,time){
    const tM = timeToMinutes(time);
    return timetableData[day].filter(e=>tM>=timeToMinutes(e.start)&&tM<timeToMinutes(e.end));
}

function addBreakAfterEvent(day,eventEnd){
    if(!timetableData[day]) timetableData[day]=[];
    const startM = timeToMinutes(eventEnd);
    const endM = startM+BREAK_DURATION;
    if(endM>=1440) return;
    const conflict = timetableData[day].some(ev=>!(endM<=timeToMinutes(ev.start)||startM>=timeToMinutes(ev.end)));
    if(conflict) return;
    timetableData[day].push({start:eventEnd,end:minutesToTime(endM),name:"Break",type:"BREAK"});
    timetableData[day].sort((a,b)=>timeToMinutes(a.start)-timeToMinutes(b.start));
}

function removeBreakAfterEvent(day,eventEnd){
    const index = timetableData[day].findIndex(ev=>ev.type==='BREAK' && timeToMinutes(ev.start)===timeToMinutes(eventEnd));
    if(index!==-1) timetableData[day].splice(index,1);
}

function extractDeadlines(){
    for(let day of DAY_NAMES){
        for(let ev of timetableData[day]){
            if(ev.type==='ACTIVITY'){
                const dayIndex = DAY_NAMES.indexOf(day);
                const base = ev.name.replace(/ \(Session \d+\)/,'');
                if(!activityDeadlines[base] || dayIndex>activityDeadlines[base]) activityDeadlines[base]=dayIndex;
            }
        }
    }
}

function renderTimetable(){
    extractDeadlines();
    const grid=document.getElementById('timetable');
    grid.innerHTML='';
    grid.appendChild(createTimeLabel(''));
    DAY_NAMES.forEach(d=>grid.appendChild(createDayHeader(d)));
    TIME_SLOTS.forEach(time=>{
        grid.appendChild(createTimeLabel(time));
        DAY_NAMES.forEach(day=>grid.appendChild(createTimeSlot(day,time)));
    });
}

function createTimeLabel(time){
    const l=document.createElement('div'); l.className='time-label'; l.textContent=time; return l;
}
function createDayHeader(day){
    const h=document.createElement('div'); h.className='day-header'; h.textContent=day; return h;
}

function createTimeSlot(day,time){
    const slot=document.createElement('div'); slot.className='time-slot'; slot.dataset.day=day; slot.dataset.time=time;
    const events = getEventsInSlot(day,time);
    events.forEach(ev=>{
        if(timeToMinutes(ev.start)===timeToMinutes(time)){
            const card=createEventCard(ev,day);
            const duration = timeToMinutes(ev.end)-timeToMinutes(ev.start);
            const heightPerHour = 50;
            card.style.height = `${duration/60*heightPerHour}px`;
            slot.appendChild(card);
        }
    });
    slot.addEventListener('dragover',handleDragOver);
    slot.addEventListener('drop',e=>handleDrop(e,day,time));
    slot.addEventListener('dragleave',handleDragLeave);
    return slot;
}

function createEventCard(ev,day){
    const card=document.createElement('div');
    card.className=`event-card ${ev.type.toLowerCase()}`;
    card.draggable = (ev.type!=='COMPULSORY' && ev.type!=='BREAK');
    if(ev.type==='ACTIVITY'){
        const base = ev.name.replace(/ \(Session \d+\)/,'');
        const maxDay = activityDeadlines[base];
        const currentDay = DAY_NAMES.indexOf(day);
        if(maxDay!==undefined && currentDay>maxDay) card.classList.add('past-deadline');
    }
    const emoji = ev.type==='COMPULSORY'?'üî¥':ev.type==='ACTIVITY'?'üîµ':'‚ö™';
    const warning = card.classList.contains('past-deadline')?' ‚ö†Ô∏è':'';
    const name = document.createElement('div'); name.className='event-name'; name.textContent=`${emoji} ${ev.name}${warning}`;
    const time = document.createElement('div'); time.className='event-time'; 
    const durationM = timeToMinutes(ev.end)-timeToMinutes(ev.start);
    const h = Math.floor(durationM/60), m = durationM%60;
    time.textContent = `${ev.start} - ${ev.end} (${h>0?h+'h ':'')}${m}m`;
    card.appendChild(name); card.appendChild(time);

    if(ev.type!=='COMPULSORY' && ev.type!=='BREAK'){
        card.addEventListener('dragstart',e=>handleDragStart(e,ev,day));
        card.addEventListener('dragend',handleDragEnd);
    }
    return card;
}

function handleDragStart(e,ev,day){ draggedElement=e.target; draggedEventData={...ev}; originalDay=day; e.target.classList.add('dragging'); }
function handleDragEnd(e){ e.target.classList.remove('dragging'); }
function handleDragOver(e){ e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
function handleDragLeave(e){ e.currentTarget.classList.remove('drag-over'); }

function handleDrop(e,targetDay,targetTime){
    e.preventDefault(); e.currentTarget.classList.remove('drag-over');
    if(!draggedEventData || draggedEventData.type==='COMPULSORY') return;
    const baseName = draggedEventData.name.replace(/ \(Session \d+\)/,'');
    const maxDay = activityDeadlines[baseName];
    const targetDayIndex = DAY_NAMES.indexOf(targetDay);
    if(maxDay!==undefined && targetDayIndex>maxDay){ alert('‚ö†Ô∏è Cannot move activity past its deadline!'); return; }

    const duration = timeToMinutes(draggedEventData.end)-timeToMinutes(draggedEventData.start);
    const newStartM = timeToMinutes(targetTime); const newEndM = newStartM+duration; const breakEndM=newEndM+BREAK_DURATION;
    const newStart = minutesToTime(newStartM); const newEnd = minutesToTime(newEndM);

    const conflict = timetableData[targetDay].some(ev=>{
        if(ev.name===draggedEventData.name && ev.start===draggedEventData.start) return false;
        return !(breakEndM<=timeToMinutes(ev.start) || newStartM>=timeToMinutes(ev.end));
    });
    if(conflict){ alert('‚ö†Ô∏è Time slot is occupied (including break)!'); return; }

    removeBreakAfterEvent(originalDay,draggedEventData.end);
    const idx = timetableData[originalDay].findIndex(ev=>ev.name===draggedEventData.name && ev.start===draggedEventData.start && ev.type===draggedEventData.type);
    if(idx!==-1) timetableData[originalDay].splice(idx,1);

    timetableData[targetDay].push({...draggedEventData,start:newStart,end:newEnd});
    addBreakAfterEvent(targetDay,newEnd);
    timetableData[targetDay].sort((a,b)=>timeToMinutes(a.start)-timeToMinutes(b.start));
    renderTimetable();
}

function renderListView(){
    const listContainer=document.getElementById('list-view'); listContainer.innerHTML='';
    DAY_NAMES.forEach(day=>{
        const dayDiv=document.createElement('div'); dayDiv.className='day-list';
        const title=document.createElement('div'); title.className='day-title'; title.textContent=`üìÖ ${day}`; dayDiv.appendChild(title);
        if(!timetableData[day] || timetableData[day].length===0){
            const empty=document.createElement('div'); empty.className='empty-day'; empty.textContent='No events scheduled'; dayDiv.appendChild(empty);
        }else{
            timetableData[day].forEach(ev=>{
                const item=document.createElement('div'); item.className=`event-list-item ${ev.type.toLowerCase()}`;
                if(ev.type==='ACTIVITY'){
                    const base=ev.name.replace(/ \(Session \d+\)/,'');
                    const maxDay=activityDeadlines[base]; const currentDay=DAY_NAMES.indexOf(day);
                    if(maxDay!==undefined && currentDay>maxDay) item.classList.add('past-deadline');
                }
                const durationM=timeToMinutes(ev.end)-timeToMinutes(ev.start);
                const h=Math.floor(durationM/60), m=durationM%60; const durationStr=h>0?h+'h '+m+'m':m+'m';
                const emoji=ev.type==='COMPULSORY'?'üî¥':ev.type==='ACTIVITY'?'üîµ':'‚ö™';
                const warning = item.classList.contains('past-deadline')?' ‚ö†Ô∏è':'';
                item.innerHTML=`<strong>${emoji} ${ev.name}${warning}</strong><span>${ev.start} - ${ev.end} ‚Ä¢ ${durationStr}</span>`;
                dayDiv.appendChild(item);
            });
        }
        listContainer.appendChild(dayDiv);
    });
}

function saveTimetable(){ console.log('Timetable saved:',timetableData); alert('‚úÖ Timetable saved!'); }
function resetTimetable(){ if(confirm('Reset timetable to original?')){ timetableData=JSON.parse(JSON.stringify(originalData)); renderTimetable(); if(document.getElementById('list-tab').classList.contains('active')) renderListView(); } }

renderTimetable();
</script>
</body>
</html>
